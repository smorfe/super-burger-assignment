var finalOrder={},orderLineItems={},finalAmount=0;function disableNonApplePayButton(t){$("#place-order-button").prop("disabled",t)}function loadProducts(){$.getJSON("content/products.json",function(t){var i=[];$.each(t,function(t,e){var o={product:e,count:0},e=void 0===(orderLineItems[o.product.id]=o).product.options,e='<div class=\'list-item\'><div class="list-wrapper"><div class="list-header"><div class="list-image"><img src="content/assets/productImages/'+o.product.image+'"/></div><h2>'+o.product.name+'</h2></div><div class="list-content"><p> '+o.product.description+"</p>"+(e?"":"<div class='options-btn-group'><small><strong>Sizes:</strong></small>"+buildOptions(o.product.options,o.product.id)+"</div>")+"</div><div class='list-price'>"+(e?"<p><strong>$"+o.product.price/100+" ea.</strong></p>":"<p class='product-option-price' id='product-option-price-"+o.product.id+"'></p>")+'<a id="btn_'+o.product.id+'_add" onclick="productAdded(this)" href="#purchase-popup" class="add-button '+(e?"":"isDisabled")+'" data-rel="popup" data-position-to="#added-product-popup"><span class="add-product-label" id="add-product-label-'+o.product.id+'">'+(e?"Add to Cart":"Select a size")+"</span></a></div></div></div>";i.push(e)}),$("#all-products").append(i.join(""))})}function buildOptions(t,o){var i="<ul>";return $.each(t,function(t,e){i=i+'<li><label><input type="radio" id="option_PRODprice_'+o+"_"+t+'" name="order_PRODoption_price_'+o+'" data-option-selected="'+t+'" value="'+e+'" onchange="productOptionPrice('+e+", '"+o+"')\" /><span>"+t+"</span></label></li>"}),i+="</ul>"}function productOptionPrice(t,e){t/=100;$("#product-option-price-"+e).text("$"+t+" ea."),$("#add-product-label-"+e).text("Add to Cart"),$(".isDisabled").removeClass("isDisabled")}function productAdded(t){var e=getProductId(t.id),o=orderLineItems[e],t=$('input[name="order_PRODoption_price_'+e+'"]:checked');o.product.options&&0<t.length&&(o.product.price=t.val(),$('input[name="order_PRODoption_price_'+e+'"]:checked').prop("checked",!1),$("#add-product-label-"+e).text("Select a size"),$("#product-option-price-"+e).empty(),$(".isDisabled").addClass("isDisabled")),setTimeout(function(){$("#purchase-popup").popup("close")},1100),o.product.options&&0===t.length?$("#notification").html("<strong>Please select a size.</strong>"):(o.count=o.count+1,orderLineItems[e]=o,$("#notification").html("<strong>"+o.product.name+"</strong><em> is added to the cart.</em>"),calculatePrice(),disableNonApplePayButton(!1),repaintSelectedList())}function productRemoved(t){var e=getProductId(t.id),t=orderLineItems[e];0<t.count&&(t.count=t.count-1,orderLineItems[e]=t,console.log(e+" - "+t.count)),calculatePrice(),repaintSelectedList()}function repaintSelectedList(){var o=[];$.each(orderLineItems,function(t,e){0!=e.count&&(e="<li><div class='list-item'><div class='list-heading'><img src=\"content/assets/productImages/"+e.product.image+'" width="80" /><h2>'+e.product.name+"</h2></div><div class='list-count'><p>"+e.count+"</p></div><div class='list-remove'><a id=\"btn_"+e.product.id+'_add" onclick="productRemoved(this)" href="#purchase" class="ui-btn ui-nodisc-icon ui-icon-delete ui-corner-all ui-btn-icon ui-btn-icon-notext">Remove</a></div></div></li>',o.push(e))}),$("#selected-products").empty(),$("#selected-products").append(o.join("")),$("#selected-products").listview("refresh")}function getProductId(t){var e=t.indexOf("_")+1,o=t.lastIndexOf("_");return t.substring(e,o)}function calculatePrice(){var o=0,i=[],n=0;console.log(orderLineItems),$.each(orderLineItems,function(t,e){0!=e.count&&(n+=e.count,o+=e.count*e.product.price,i.push(e))});var t=o/100;$("#total-items").text("Items: "+n),$("#total-price").text("Total: $"+t),$("#payment_amount").text("Total: $"+t),finalOrder={finalOrderItems:i,subTotal:o,formattedSubTotal:t},0==(finalAmount=o)&&disableNonApplePayButton(!0),console.log("Final amount : "+finalAmount),console.log(JSON.stringify(finalOrder))}$(document).ready(function(){loadProducts(),$("#place-order-button").click(function(){fetch("OrderProcessingServlet",{method:"POST",body:JSON.stringify({order:finalOrder}),headers:{"content-type":"application/json"}}).then(function(t){t.ok?console.log("Post Non Apple Payment successful !"):console.log("Post Non Apple Payment Post failed !!!")})}),disableNonApplePayButton(!0)}),$(document).on("pageinit","#cart",function(t){repaintSelectedList()});